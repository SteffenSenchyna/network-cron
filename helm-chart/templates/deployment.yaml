apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: { { include "helm-chart.fullname" . } }
  labels: { { - include "helm-chart.labels" . | nindent 4 } }
spec:
  schedule: { { .Values.cronjob.schedule } }
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: { { .Chart.Name } }
              image: "{{ .Values.image.repository }}:{{ .Values.image.tag | default .Chart.AppVersion }}"
              imagePullPolicy: { { .Values.image.pullPolicy } }
              env:
                - name: NETBOXTOKEN
                  valueFrom:
                    configMapKeyRef:
                      name: network-cron-config
                      key: NETBOXTOKEN
                - name: MONGOURL
                  valueFrom:
                    configMapKeyRef:
                      name: network-cron-config
                      key: MONGOURL
                - name: NETBOXURL
                  valueFrom:
                    configMapKeyRef:
                      name: network-cron-config
                      key: NETBOXURL
                - name: DISCORDURL
                  valueFrom:
                    configMapKeyRef:
                      name: network-cron-config
                      key: DISCORDURL
          restartPolicy: OnFailure
